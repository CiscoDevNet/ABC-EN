---

variables:
  device_list:
    - inet-rtr1
    - inet-rtr2

TestInterfaceConfiguration:
  source:
    pkg: genie.libs.sdk
    class: triggers.blitz.blitz.Blitz

  test_sections:
    - test_interfaces:
        - loop:
            loop_variable_name: current_device
            value: "%{testbed.topology}"
            actions:
              - loop:
                  loop_variable_name: current_interface
                  value: "%VARIABLES{current_device._values.interfaces}"
                  actions:
                    - parse:
                        command: show interfaces %VARIABLES{current_interface._keys} description
                        device: "%VARIABLES{current_device._keys}"
                        include:
                          - contains_key_value("description", "%VARIABLES{current_interface._values.description}")

                    - parse:
                        command: show ipv6 interface %VARIABLES{current_interface._keys}
                        device: "%VARIABLES{current_device._keys}"
                        include:
                          - |
                            contains_key_value("ipv6",
                              "%VARIABLES{current_interface._values.link_local}",
                              ignore_case_value=True, value_regex=True
                            )
                          - |
                            contains_key_value("ipv6",
                              "%VARIABLES{current_interface._values.ipv6}/%VARIABLES{current_interface._values.ipv6_prefix_length}",
                              ignore_case_value=True, value_regex=True
                            )
